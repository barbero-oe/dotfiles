#!/usr/bin/env bash

if [[ -f "$1" ]]; then
    FILE="$1"
elif [[ ! -t 0 ]]; then
    FILE="/dev/stdin"
else
    echo "Expected filename or pipe input"
    exit 1
fi

while IFS= read -r line; do
    item="" in_quotes=0 items=()
    for (( i=0; i<${#line}; i++ )); do
        char="${line:$i:1}"
        if [[ "$char" == '"' ]]; then
            in_quotes=$((1 - in_quotes))
            continue
        elif [[ "$char" == ","  ]] && (( !in_quotes )); then
            items+=("$item")
            item=""
            continue
        else
            item+="$char"
        fi
    done
    [[ -n "$item" ]] && items+=("$item")
    printf "%s\t" "${items[@]}"
    printf "\n"
 done < "$FILE"
