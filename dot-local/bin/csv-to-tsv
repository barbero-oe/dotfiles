#!/usr/bin/env bash

if [[ -f "$1" ]]; then
    FILE="$1"
elif [[ ! -t 0 ]]; then
    FILE="/dev/stdin"
else
    echo "Expected filename or pipe input"
    exit 1
fi

while IFS=, read -ra fields; do
    item=""
    concat=false
    items=()
    for field in "${fields[@]}" ; do
        if [[ "$field" =~ ^\".* ]]; then
            concat=true
            item="${field#\"}"
            continue
        elif [[ "$field" =~ \"$ ]]; then
            concat=false
            item+=",${field%\"}"
        elif [[ $concat == true  ]]; then
            item+=",$field"
        else
            item="$field"
        fi
        items+=("$item")
        item=""
    done
    printf "%s\t" "${items[@]}"
    printf "\n"
 done < "$FILE"
